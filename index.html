<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Code Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #1e1e1e;
        }
        
        /* VS Code Title Bar */
        .title-bar {
            background: #323233;
            color: #cccccc;
            height: 35px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            border-bottom: 1px solid #252526;
        }
        
        .title-bar .icon {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            font-size: 16px;
        }
        
        .title-bar .title {
            font-size: 13px;
            flex-grow: 1;
        }
        
        .title-bar .controls {
            display: flex;
            gap: 5px;
        }
        
        .title-bar button {
            background: transparent;
            border: none;
            color: #cccccc;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            border-radius: 3px;
        }
        
        .title-bar button:hover {
            background: #2a2d2e;
        }
        
        /* Main Container */
        .main-container {
            display: flex;
            height: calc(100vh - 35px);
        }

        /* File Explorer Sidebar */
        .sidebar {
            width: 250px;
            background: #252526;
            border-right: 1px solid #1e1e1e;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 10px;
            color: #cccccc;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            border-bottom: 1px solid #1e1e1e;
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 5px 0;
        }

        .file-item {
            padding: 5px 20px;
            color: #cccccc;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item:hover {
            background: #2a2d2e;
        }

        .file-item.active {
            background: #37373d;
            color: #ffffff;
        }

        .url-input-container {
            padding: 10px;
            border-bottom: 1px solid #1e1e1e;
        }

        .url-input {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #1e1e1e;
            color: #cccccc;
            font-size: 12px;
            border-radius: 3px;
        }

        .url-input:focus {
            outline: none;
            border-color: #007acc;
        }

        .load-btn {
            width: 100%;
            margin-top: 5px;
            padding: 8px;
            background: #0e639c;
            border: none;
            color: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .load-btn:hover {
            background: #1177bb;
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* VS Code Tabs */
        .tabs {
            background: #252526;
            display: flex;
            border-bottom: 1px solid #1e1e1e;
            height: 35px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 0 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #969696;
            cursor: pointer;
            border-right: 1px solid #1e1e1e;
            font-size: 13px;
            background: #2d2d2d;
            white-space: nowrap;
        }
        
        .tab.active {
            background: #1e1e1e;
            color: #ffffff;
            border-bottom: 1px solid #007acc;
        }
        
        .tab:hover {
            color: #ffffff;
        }

        .tab .close {
            margin-left: 5px;
            opacity: 0.6;
        }

        .tab .close:hover {
            opacity: 1;
        }
        
        /* Editor and Preview Split */
        .split-view {
            flex: 1;
            display: grid;
            grid-template-columns: 2fr 1fr;
            overflow: hidden;
        }
        
        .editor-pane {
            display: flex;
            flex-direction: column;
            border-right: 1px solid #1e1e1e;
        }
        
        .preview-pane {
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
        }
        
        .pane-header {
            background: #252526;
            padding: 8px 15px;
            color: #cccccc;
            font-size: 12px;
            border-bottom: 1px solid #1e1e1e;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .editor {
            flex: 1;
            width: 100%;
            display: none;
        }

        .editor.active {
            display: block;
        }
        
        #preview {
            flex: 1;
            border: none;
            background: white;
        }
        
        /* VS Code Status Bar */
        .status-bar {
            background: #007acc;
            color: white;
            height: 22px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 12px;
            gap: 15px;
        }
        
        .status-bar .item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-bar .spacer {
            flex: 1;
        }
        
        /* Download Button */
        .download-btn {
            background: #0e639c;
            border: none;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }
        
        .download-btn:hover {
            background: #1177bb;
        }

        .loading {
            padding: 20px;
            color: #cccccc;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Title Bar -->
    <div class="title-bar">
        <span class="icon">üöÄ</span>
        <span class="title">URL Content Editor</span>
        <div class="controls">
            <button onclick="downloadAllFiles()">üíæ Download All</button>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="url-input-container">
                <input type="text" class="url-input" id="urlInput" placeholder="Enter URL to load...">
                <button class="load-btn" onclick="loadFromURL()">Load Content</button>
            </div>
            <div class="sidebar-header">Explorer</div>
            <div class="file-tree" id="fileTree">
                <div class="loading">Enter a URL to load files</div>
            </div>
        </div>

        <!-- Editor Container -->
        <div class="editor-container">
            <!-- Tabs -->
            <div class="tabs" id="tabs"></div>
            
            <!-- Split View -->
            <div class="split-view">
                <!-- Editor Pane -->
                <div class="editor-pane">
                    <div class="pane-header">
                        <span>ÔøΩ</span>
                        <span>Editor</span>
                    </div>
                    <div id="editorContainer"></div>
                </div>
                
                <!-- Preview Pane -->
                <div class="preview-pane">
                    <div class="pane-header">
                        <span>üëÅÔ∏è</span>
                        <span>Live Preview</span>
                    </div>
                    <iframe id="preview" sandbox="allow-same-origin allow-scripts"></iframe>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="item">
            <span>üìÑ</span>
            <span id="fileCount">0 files</span>
        </div>
        <div class="spacer"></div>
        <div class="item">
            <span id="activeFileName">No file open</span>
        </div>
    </div>

    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <script>
        let editors = {};
        let files = {};
        let activeFile = null;
        let updateTimeout;
        
        // Check URL path on load
        window.addEventListener('load', () => {
            const path = window.location.pathname.substring(1);
            if (path) {
                document.getElementById('urlInput').value = path;
                loadFromURL();
            }
        });

        // Load Monaco Editor
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });
        
        require(['vs/editor/editor.main'], function() {
            console.log('Monaco Editor loaded');
        });

        async function loadFromURL() {
            const urlInput = document.getElementById('urlInput').value.trim();
            if (!urlInput) {
                alert('Please enter a URL');
                return;
            }

            // Update browser URL
            window.history.pushState({}, '', '/' + urlInput);

            const fileTree = document.getElementById('fileTree');
            fileTree.innerHTML = '<div class="loading">Loading content...</div>';

            try {
                const response = await fetch(urlInput);
                if (!response.ok) throw new Error('Failed to fetch URL');
                
                const contentType = response.headers.get('content-type');
                const content = await response.text();

                // Parse content and create files
                parseContent(content, contentType, urlInput);
                
            } catch (error) {
                console.error('Error loading URL:', error);
                fileTree.innerHTML = '<div class="loading">Error loading content. Check console.</div>';
                alert('Failed to load content from URL: ' + error.message);
            }
        }

        function parseContent(content, contentType, url) {
            files = {};
            
            // Determine file type and create appropriate files
            if (contentType && contentType.includes('html')) {
                // HTML content - extract scripts and styles
                const parser = new DOMParser();
                const doc = parser.parseFromString(content, 'text/html');
                
                // Main HTML file
                files['index.html'] = {
                    name: 'index.html',
                    content: content,
                    language: 'html'
                };

                // Extract inline scripts
                const scripts = doc.querySelectorAll('script:not([src])');
                scripts.forEach((script, i) => {
                    if (script.textContent.trim()) {
                        files[`script${i + 1}.js`] = {
                            name: `script${i + 1}.js`,
                            content: script.textContent,
                            language: 'javascript'
                        };
                    }
                });

                // Extract inline styles
                const styles = doc.querySelectorAll('style');
                styles.forEach((style, i) => {
                    if (style.textContent.trim()) {
                        files[`style${i + 1}.css`] = {
                            name: `style${i + 1}.css`,
                            content: style.textContent,
                            language: 'css'
                        };
                    }
                });
            } else if (contentType && contentType.includes('javascript')) {
                files['script.js'] = {
                    name: 'script.js',
                    content: content,
                    language: 'javascript'
                };
            } else if (contentType && contentType.includes('css')) {
                files['style.css'] = {
                    name: 'style.css',
                    content: content,
                    language: 'css'
                };
            } else if (contentType && contentType.includes('json')) {
                files['data.json'] = {
                    name: 'data.json',
                    content: content,
                    language: 'json'
                };
            } else {
                // Default to text file
                const filename = url.split('/').pop() || 'content.txt';
                files[filename] = {
                    name: filename,
                    content: content,
                    language: detectLanguage(filename)
                };
            }

            renderFileTree();
            if (Object.keys(files).length > 0) {
                openFile(Object.keys(files)[0]);
            }
        }

        function detectLanguage(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const langMap = {
                'html': 'html',
                'htm': 'html',
                'css': 'css',
                'js': 'javascript',
                'json': 'json',
                'xml': 'xml',
                'md': 'markdown',
                'txt': 'plaintext',
                'py': 'python',
                'java': 'java',
                'cpp': 'cpp',
                'c': 'c',
                'php': 'php',
                'rb': 'ruby',
                'go': 'go',
                'rs': 'rust',
                'ts': 'typescript',
                'jsx': 'javascript',
                'tsx': 'typescript'
            };
            return langMap[ext] || 'plaintext';
        }

        function renderFileTree() {
            const fileTree = document.getElementById('fileTree');
            fileTree.innerHTML = '';

            Object.keys(files).forEach(filename => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `<span>üìÑ</span><span>${filename}</span>`;
                fileItem.onclick = () => openFile(filename);
                fileTree.appendChild(fileItem);
            });

            // Update status bar
            document.getElementById('fileCount').textContent = `${Object.keys(files).length} files`;
        }

        function openFile(filename) {
            if (!files[filename]) return;

            activeFile = filename;

            // Update file tree selection
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('active');
                if (item.textContent.includes(filename)) {
                    item.classList.add('active');
                }
            });

            // Create editor if it doesn't exist
            if (!editors[filename]) {
                createEditor(filename);
            }

            // Show active editor, hide others
            Object.keys(editors).forEach(name => {
                const editorEl = editors[name].getDomNode();
                editorEl.classList.toggle('active', name === filename);
            });

            // Update tabs and status bar
            renderTabs();
            updatePreview();
            document.getElementById('activeFileName').textContent = filename;
        }

        function createEditor(filename) {
            const file = files[filename];
            const container = document.getElementById('editorContainer');
            
            const editorDiv = document.createElement('div');
            editorDiv.className = 'editor';
            editorDiv.id = `editor-${filename}`;
            container.appendChild(editorDiv);

            const editor = monaco.editor.create(editorDiv, {
                value: file.content,
                language: file.language,
                theme: 'vs-dark',
                automaticLayout: true,
                fontSize: 14,
                minimap: { enabled: true },
                scrollBeyondLastLine: false,
                wordWrap: 'on',
                lineNumbers: 'on',
                renderWhitespace: 'selection',
                tabSize: 2,
                insertSpaces: true
            });

            editors[filename] = editor;

            // Update content on change
            editor.onDidChangeModelContent(() => {
                files[filename].content = editor.getValue();
                clearTimeout(updateTimeout);
                updateTimeout = setTimeout(updatePreview, 300);
            });
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('tabs');
            tabsContainer.innerHTML = '';

            Object.keys(editors).forEach(filename => {
                const tab = document.createElement('div');
                tab.className = 'tab' + (filename === activeFile ? ' active' : '');
                tab.innerHTML = `
                    <span>üìÑ</span>
                    <span>${filename}</span>
                    <span class="close" onclick="closeFile('${filename}', event)">‚úï</span>
                `;
                tab.onclick = (e) => {
                    if (!e.target.classList.contains('close')) {
                        openFile(filename);
                    }
                };
                tabsContainer.appendChild(tab);
            });
        }

        function closeFile(filename, event) {
            event.stopPropagation();
            
            if (editors[filename]) {
                editors[filename].dispose();
                delete editors[filename];
                
                const editorEl = document.getElementById(`editor-${filename}`);
                if (editorEl) editorEl.remove();
            }

            // Open another file if this was active
            if (activeFile === filename) {
                const remainingFiles = Object.keys(editors);
                if (remainingFiles.length > 0) {
                    openFile(remainingFiles[0]);
                } else {
                    activeFile = null;
                }
            }

            renderTabs();
        }

        function updatePreview() {
            // Find HTML file for preview
            const htmlFile = Object.keys(files).find(name => 
                files[name].language === 'html'
            );

            if (!htmlFile) return;

            const preview = document.getElementById('preview');
            const previewDoc = preview.contentDocument || preview.contentWindow.document;
            
            previewDoc.open();
            previewDoc.write(files[htmlFile].content);
            previewDoc.close();
        }

        function downloadAllFiles() {
            Object.keys(files).forEach(filename => {
                const file = files[filename];
                const blob = new Blob([file.content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        // Handle URL changes
        window.addEventListener('popstate', () => {
            const path = window.location.pathname.substring(1);
            if (path) {
                document.getElementById('urlInput').value = path;
                loadFromURL();
            }
        });
    </script>
</body>
</html>
